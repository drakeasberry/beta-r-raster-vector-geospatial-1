---
title: "Open and Plot Shapefiles in R"
teaching: 20
exercises: 10
questions:
- "How can I distinguish between and visualize point, line and polygon vector data?"
objectives:
- "Know the difference between point, line, and polygon vector elements."
- "Understand the differences between opening point, line and polygon shapefiles in `R`."
- "Understand the components of a spatial object in `R`."
keypoints:
- ""
---

```{r setup, echo=FALSE}
source("../bin/chunk-options.R")
source("../setup.R")
knitr_fig_path("06-")
```

```{r load-libraries, echo = FALSE, results='hide', message = FALSE}
library(raster)
library(rgdal)
library(ggplot2)
library(dplyr)
```

> ## Things Youâ€™ll Need To Complete This Episode
> See the [lesson homepage]({{ site.baseurl }}) for detailed information about the software,
> data, and other prerequisites you will need to work through the examples in this episode.
{: .prereq}

In this episode, we will open and plot point, line and polygon vector data
stored in shapefile format in `R`.

## Import Shapefiles

We will use the `sf` package to work with vector data in `R`. Notice that the
`rgdal` package automatically loads when `sf` is loaded. We will use the
`raster` package, which has been loaded in previous episodes, so we can explore raster and vector spatial metadata using similar commands.

```{r load-sf, results='hide'}
library(sf)
```

The shapefiles that we will import are:

* A polygon shapefile representing our field site boundary,
* A line shapefile representing roads, and
* A point shapefile representing the location of the Fisher
<a href="http://www.neonscience.org/science-design/collection-methods/flux-tower-measurements" target="_blank">flux tower</a>
located at the
<a href="http://www.neonscience.org/science-design/field-sites/harvard-forest" target="_blank"> NEON Harvard Forest field site</a>.

The first shapefile that we will open contains the boundary of our study area
(or our Area Of Interest or AOI, hence the name `aoiBoundary`). To import
shapefiles we use the `sf` function `st_read`.

`st_read()` requires the file path to the shapefile.

Let's import our AOI.

```{r Import-Shapefile}
# Import a polygon shapefile
aoi_boundary_HARV <- st_read(
  "data/NEON-DS-Site-Layout-Files/HARV/HarClip_UTMZ18.shp")
```

## Shapefile Metadata & Attributes

When we import the `HarClip_UTMZ18` shapefile layer into `R` (as our
`aoi_boundary_HARV` object), the `st_read()` function automatically stores
information about the data. We are particularly interested in the geospatial
**metadata**, describing the format, `CRS`, `extent`, and other components of
the vector data, and the **attributes** which describe properties associated
with each individual vector object.

> ## Data Tip
> The [Shapefile Metadata & Attributes in R]({{site.baseurl}}/R/shapefile-attributes-in-R/)
> episode provides more information on both metadata and attributes
> and using attributes to subset and plot data.
{: .callout}

## Spatial Metadata
Key metadata for all shapefiles include:

1. **Object Type:** the class of the imported object.
2. **Coordinate Reference System (CRS):** the projection of the data.
3. **Extent:** the spatial extent (geographic area that the shapefile covers) of
the shapefile. Note that the spatial extent for a shapefile represents the
extent for ALL spatial objects in the shapefile.

We can view shapefile metadata using the `st_geometry_type`, `st_crs` and `st_bbox` methods:

```{r view-metadata}
# view just the geometry type for the shapefile
st_geometry_type(aoi_boundary_HARV)

# view just the crs for the shapefile
st_crs(aoi_boundary_HARV)

# view just the extent for the shapefile
st_bbox(aoi_boundary_HARV)

# view all metadata at same time
aoi_boundary_HARV
```

Our `aoi_boundary_HARV` is an `sf` polygon object,
in the CRS **UTM zone 18N**. The CRS is critical to interpreting the object
`extent` values as it specifies units.

![The spatial extent of a shapefile or R spatial object represents the geographic "edge" or location that is the furthest north, south east and west. Thus is represents the overall geographic coverage of the spatial object. Image Source: National Ecological Observatory Network (NEON)](../images/dc-spatial-vector/spatial_extent.png)

## Spatial Data Attributes
We introduced the idea of spatial data attributes in [an earlier lesson](https://datacarpentry.org/organization-geospatial/01-spatial-data-structures-formats/index.html). Now we will explore
how to use spatial data attributes stored in our data to plot
different features.

We can view the attributes of an `sf` object by printing it to the screen. The geometry of the object can be dropped by turning the object into a `data.frame`.

``` {r Shapefile-attributes-2}
aoi_boundary_HARV

# alternate way to view attributes
data.frame(aoi_boundary_HARV)
```

In this case, our polygon object only has one attribute: `id`.

## Metadata & Attribute Summary
We can view a metadata & attribute summary of each shapefile by entering
the name of the `R` object in the console. Note that the metadata output
includes the **geometry type**, the number of **features**, the **extent**, and the
**coordinate reference system** (`crs`) of the `R` object. The output of `summary()` shows a preview of the `R` object **attributes**.

```{r shapefile-summary}
# view a summary of metadata & attributes associated with the spatial object
summary(aoi_boundary_HARV)
```


# Plot a Shapefile
Next, let's visualize the data in our `sf` object using the `ggplot` package.

``` {r plot-shapefile}
ggplot() + 
  geom_sf(data = aoi_boundary_HARV, size = 3, color = "black", fill = "cyan1") + 
  ggtitle("AOI Boundary Plot")
```

> ## Challenge: Import Line and Point Shapefiles
> 
> Using the steps above, import the HARV_roads and HARVtower_UTM18N layers into
> `R`. Call the Harv_roads object `lines_HARV` and the HARVtower_UTM18N
> `point_HARV`.
> 
> Answer the following questions:
> 
> 1. What type of `R` spatial object is created when you import each layer?
> 
> 2. What is the `CRS` and `extent`for each object?
> 
> 3. Do the files contain, points, lines or polygons?
> 
> 4. How many spatial objects are in each file?
> 
> > ## Answers
> > 
> > ```{r import-point-line, echo=TRUE}
> > # import line shapefile
> > lines_HARV <- st_read("data/NEON-DS-Site-Layout-Files/HARV/HARV_roads.shp")
> > # import point shapefile
> > point_HARV <- st_read("data/NEON-DS-Site-Layout-Files/HARV/HARVtower_UTM18N.shp")
> > 
> > # 1
> > class(lines_HARV)
> > class(point_HARV)
> > 
> > # 2
> > st_crs(lines_HARV)
> > st_bbox(lines_HARV)
> > st_crs(point_HARV)
> > st_bbox(point_HARV)
> > 
> > # 3
> > #lines_HARV contains only lines and point_HARV contains only 1 point
> > 
> > # 4 -> numerous ways to find this
> > nrow(lines_HARV)
> > lines_HARV  #look at 'features'
> > 
> > ```
> {: .solution}
{: .challenge}
